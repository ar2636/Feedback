---
title: "Dissertation Analytics Notebook"
output:
  pdf_document: default
  html_document:
    df_print: paged
  word_document: default
---

```{r Load Packages, include=FALSE}
library(gdata)
library(lavaan)
library(MVN)
library(faoutlier)
library(car)
library(psych)
library(ggplot2)
library(graphics)
```


The code below simply loads the data into r. The "gdata" package simply allows '.csv' files to be read. 
```{r Load Data, include = TRUE}

#Open gdata: this package allows you to open .xls files.
library(gdata)
Diss_Final_Datafile_CLEANED <- read.csv("data.csv")

#Subset data into a new dataframe called "likert". This dataframe contains only likert scaled data (i.e., your item response data).
likert <- Diss_Final_Datafile_CLEANED[c(4,5,7:10,12:31,34:38,40:43,47,48)]

#Classify likert-type data as numeric. 
likert <- as.data.frame(lapply(likert, as.numeric))
```

Below, I checked for multivariate normality.
```{r Checking Assumptions, include = TRUE}
#For running factor analyses: Download and open the 'lavaan' package. 
library(lavaan)

#Testing for Multivariate Normality
library(MVN)
result <- mardiaTest(likert, cov = FALSE, qqplot = TRUE)
result
result1 <- hzTest(likert, qqplot = FALSE)
result1
```

```{r CFAs, include = TRUE}

library(lavaan)

#CFA with maximum likelihood estimation
DissCFA1 <- ' DTR  =~ DesToResp1 + DesToResp2 + DesToResp3 + DesToResp4Reco
              DJ =~ DisJust1 + DisJust2  + DisJust3 + DisJust4
              POFA   =~ PercepAcc1 + PercepAcc2 + PercepAcc3 + PercepAcc4Reco + PercepAcc5
              PA =~ Interested + Excited + Strong + Enthusiastic + Proud + Determined + Attentive + Active + Inspired + Alert
              Na =~ Distressed + Upset + Guilty + Scared + Hostile + Ashamed + Nervous + Afraid + Jittery + Irritable
'
fit <- cfa(DissCFA1, data=likert, orthogonal=FALSE)
MI <- modindices(fit)
summary(fit, fit.measures=TRUE, standardized = TRUE)
write.csv(MI, file = "DissCFA1MI.csv")

##Separate CFAs
#Desire to Respond CFA
#DTRCFA <- ' DTR  =~ DesToResp1 + DesToResp2 + DesToResp3 + DesToResp4Reco'

#fit <- cfa(DTRCFA, data=likert)
#MI <- modindices(fit)
#summary(fit, fit.measures=TRUE, standardized = TRUE)
#write.csv(MI, file = "DissCFA1MI.csv")

#POFA CFA
#POFACFA <- 'POFA   =~ PercepAcc1 + PercepAcc2 + PercepAcc3 + PercepAcc4Reco + PercepAcc5'

#fit <- cfa(POFACFA, data=likert)
#MI <- modindices(fit)
#summary(fit, fit.measures=TRUE, standardized = TRUE)
#write.csv(MI, file = "DissCFA1MI.csv")

#DJ CFA
#DJCFA <- 'DJ =~ DisJust1 + DisJust2  + DisJust3 + DisJust4'

#fit <- cfa(DJCFA, data=likert)
#MI <- modindices(fit)
#summary(fit, fit.measures=TRUE, standardized = TRUE)
#write.csv(MI, file = "DissCFA1MI.csv")

#PANAS CFA
#PANASCFA <- 'PA =~ Interested + Excited + Strong + Enthusiastic + Proud + Determined + Attentive + Active + Inspired + Alert 
#NA =~ Distressed + Upset + Guilty + Scared + Hostile + Irritable + Ashamed + Nervous + Jittery + Afraid
#'

#fit <- cfa(PANASCFA, data=likert)
#MI <- modindices(fit)
#summary(fit, fit.measures=TRUE, standardized = TRUE)
#write.csv(MI, file = "DissCFA1MI.csv")

#Checking for multivariate outliers using "faoutlier
library(faoutlier)
#FS <- forward.search(data,DissSEM1)
#Getting generalized Cooks Distance and DFBETAs.
x <- gCD(data,DissSEM1,progress = TRUE)
#Index plot for gCD.
plot(x, y = NULL, main = "Generalized Cook Distance",
  type = c("p", "h"), ylab = "gCD")
#Print out top 10 cases.
print(x, ncases = 10, stat = "gCD")
```

```{r Excluding outliers from model, include = TRUE}
#Excluding outliers
dm7 <- likert[-c(535, 433, 756, 73, 28, 482, 681), ]
```

A second CFA was run without Jittery and Irritable since those 2 items had the highest MIs and loaded onto inappropriate factors. This CFA also excluded the 7 most extreme multivariate outliers.
```{r CFA2 without jittery and irritable and outliers, include = TRUE}
DissCFA2 <- ' DTR  =~ DesToResp1 + DesToResp2 + DesToResp3 + DesToResp4Reco
              DJ =~ DisJust1 + DisJust2  + DisJust3 + DisJust4
              POFA   =~ PercepAcc1 + PercepAcc2 + PercepAcc3 + PercepAcc4Reco + PercepAcc5
              PA =~ Interested + Excited + Strong + Enthusiastic + Proud + Determined + Attentive + Active + Inspired + Alert
              Na =~ Distressed + Upset + Guilty + Scared + Hostile + Ashamed + Nervous + Afraid + Jittery + Irritable
'
fit <- cfa(DissCFA2, data, std.lv = TRUE, estimator = "WLSMV")
summary(fit, fit.measures=TRUE,standardized = TRUE, rsquare=TRUE, ci=TRUE)

#fit <- cfa(DissCFA2, data=dm7, estimator = "WLSMV", orthogonal=FALSE)
#MI <- modindices(fit)
summary(fit, standardized = TRUE)
fitMeasures(fit, c("chisq", "df", "pvalue", "cfi"))
write.csv(MI, file = "DissCFA2MI.csv")

```

```{r Include Conditions and Interactions, include = TRUE}
#Create conditional/moderator dataset and bind to likert dataset.
cond <- Diss_Final_Datafile_CLEANED[c(6,62,64,67)]

#Remove outliers
cond <- cond[-c(535, 433, 756, 73, 28, 482, 681), ]
#Positive Valence is 1
#Negative Valence is 2

#Define the 'cond' dataframe as numeric.
cond <- as.data.frame(lapply(cond, as.numeric))
#"Paratelic" =  1
#"Telic" = 2

#Recode Moderator variables.
library(car)
cond$FdbkTypeN<-recode(cond$FdbkTypeN,"1=2;2=1")
cond$FdbkValN<-recode(cond$FdbkValN,"1=2;2=1")
cond$FdbkAccN<-recode(cond$FdbkAccN,"1=2;2=1")
#Positive Valence is NOW 2.
#Negative Valence is NOW 1.

#Bind cond to likert
data <- cbind(cond,dm7)

#Create the interaction terms.
##Feedback Accuracy and Information Type.
data$INTAccType <- (data$FdbkAccN-(mean(data$FdbkAccN))) * (data$FdbkTypeN-(mean(data$FdbkTypeN)))
##Paratelic and Feedback Accuracy.
data$INTParaFkAcc <- (data$ParTelic-(mean(data$ParTelic))) * (data$FdbkAccN-(mean(data$FdbkAccN)))
##Paratelic and Feedback Valence.
data$INTParaFkVal <- (data$ParTelic-(mean(data$ParTelic))) * (data$FdbkValN-(mean(data$FdbkValN)))

##Extract goal revision and performance change data. Add in task difficulty variables.
grpc <- Diss_Final_Datafile_CLEANED[c(69,70,74,75)]
grpc <- grpc[-c(535, 433, 756, 73, 28, 482, 681), ]

#Bind goal revision and performance change to main dataset.
data <- cbind(data,grpc)
```

```{r SEM, include = TRUE}
#SEM
DissSEM1 <- '
  # latent variable definitions - REMOVED JITTERY AND IRRITABLE
    POFA   =~ PercepAcc1 + PercepAcc2 + PercepAcc3 + PercepAcc4Reco + PercepAcc5
    PA =~ Interested + Excited + Strong + Enthusiastic + Proud + Determined + Attentive + Active + Inspired + Alert
    Na =~ Distressed + Upset + Guilty + Scared + Hostile + Ashamed + Nervous + Afraid
    DTR  =~ DesToResp1 + DesToResp2 + DesToResp3 + DesToResp4Reco
    DJ =~ DisJust1 + DisJust2  + DisJust3 + DisJust4

#Outcome Model
  #PerfResidGain ~ f11*GoalResidGain
  Perf1 ~ Goal1Lvl
  Perf2 ~ f11*Goal2Lvl + Perf1
#Mediators Model
  #GoalResidGain ~ e11*DTR
  Goal2Lvl ~ e11*DTR + Goal1Lvl
  DTR ~ c11*PA + c12*Na + d31*DJ
  DJ ~ c21*POFA
  POFA ~ a31*FdbkValN + a32*FdbkAccN + FdbkTypeN + ParTelic + b42*INTAccType + b41*INTParaFkAcc + b31*INTParaFkVal
  PA ~ a11*FdbkValN + d21*DJ + ParTelic+ b11*INTParaFkVal
  Na ~ a21*FdbkValN + d11*DJ + ParTelic+ b21*INTParaFkVal
#Indirect Main Effects
  ValPaDtrG := f11*e11*c11*a11
  ValNaDtrG := f11*e11*c12*a21
  ValPfaDjNaDtrG := f11*e11*c12*d11*c21*a31
  ValPfaDjPaDtrG := f11*e11*c11*d21*c21*a31
  ValPfaDjDtrG := f11*e11*d31*c21*a31
  AccPfaDjNaDtrG := f11*e11*c12*d11*c21*a32
  AccPfaDjPaDtrG := f11*e11*c11*d21*c21*a32
  AccPfaDjDtrG := f11*e11*d31*c21*a32
#Moderating Effects
  ValStPa := f11*e11*c11*b11
  ValStNa := f11*e11*c12*b21
  ValStPofa := f11*e11*d11*d21*d31*c11*c12*c21*b31
  AccTypPofa := f11*e11*d11*d21*d31*c11*c12*c21*b42
  AccStPofa := f11*e11*d11*d21*d31*c11*c12*c21*b41
#Total Significant Effects
  TotalAccEff := f11*e11*c11*d21*c21*a32 + f11*e11*d31*c21*a32
'
#Fit 'SEM' model to data
fit <- lavaan::sem(DissSEM1, data , std.lv = TRUE, estimator = "WLSMV")
summary(fit, fit.measures=TRUE,standardized = TRUE, rsquare=TRUE, ci=TRUE)
factor.scores <- predict(fit)
factor.scores <- as.data.frame(factor.scores)
factor.scores <- as.data.frame(factor.scores$POFA)
names(factor.scores) <- c("POFA")

#To visualize/plot the intraction effects, run ANOVAs and plot the results.
##Create scale scores for POFA
AccTy <- cbind(factor.scores,data[c(1,2,3,4)])
fit <- aov(POFA ~ FdbkTypeN*FdbkAccN + ParTelic*FdbkAccN + ParTelic*FdbkValN, data=AccTy) # same thing
summary(fit)
require(graphics)
FdbkTypeN <- as.factor(AccTy$FdbkTypeN)
FdbkAccN <- as.factor(AccTy$FdbkAccN)
ParTelic <- as.factor(AccTy$ParTelic)
FdbkValN <- as.factor(AccTy$FdbkValN)

#Plots using ggplot2
##Accuracy & Type
##Calculate summary statistics for POFA by IVs.
library(psych)
library(ggplot2)
dat2 <- describeBy(Diss_Final_Datafile_CLEANED$PercepAccScl,list(Diss_Final_Datafile_CLEANED$FdbkType,Diss_Final_Datafile_CLEANED$FdbkAccuracy), mat=TRUE,digits=2)
names(dat2)[names(dat2) == 'group1'] = 'FeedbackType'
names(dat2)[names(dat2) == 'group2'] = 'FeedbackAccuracy'
#levels(dat2$FeedbackType)[levels(dat2$FeedbackType)=='1'] = 'Relative'
#levels(dat2$FeedbackType)[levels(dat2$FeedbackType)=='2'] = 'Nominal'
#levels(dat2$FeedbackAccuracy)[levels(dat2$FeedbackAccuracy)=='1'] = 'Inaccurate'
#levels(dat2$FeedbackAccuracy)[levels(dat2$FeedbackAccuracy)=='2'] = 'Accurate'
dat2$se <- dat2$sd/sqrt(dat2$n)
limits <- aes(ymax = mean + (1.96*se), ymin=mean - (1.96*se))
dodge <- position_dodge(width=1)
apatheme=theme_bw()+
  theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank(),
        panel.border=element_blank(),
        axis.line=element_line(),
        text=element_text(family='Times'))
plot1 <- ggplot(dat2, aes(x = FeedbackType, y = mean, fill = FeedbackAccuracy))+
  geom_bar(stat='identity', position=dodge)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  apatheme+
  ylab('Mean POFA')+
  scale_fill_grey()
plot1
ggsave('accXtype.png', width=6, height=6, unit='in', dpi=300)

##Accuracy & State
#Calculate summary statistics for POFA by IVs.
dat2 <- describeBy(Diss_Final_Datafile_CLEANED$PercepAccScl,list(Diss_Final_Datafile_CLEANED$ParTelic,Diss_Final_Datafile_CLEANED$FdbkAccuracy), mat=TRUE,digits=2)
names(dat2)[names(dat2) == 'group1'] = 'RTState'
names(dat2)[names(dat2) == 'group2'] = 'FeedbackAccuracy'
#levels(dat2$FeedbackAccuracy)[levels(dat2$FeedbackAccuracy)=='1'] = 'Inaccurate'
#levels(dat2$FeedbackAccuracy)[levels(dat2$FeedbackAccuracy)=='2'] = 'Accurate'
#levels(dat2$RTState)[levels(dat2$RTState)=='1'] = 'Paratelic'
#levels(dat2$RTState)[levels(dat2$RTState)=='2'] = 'Telic'
dat2$se <- dat2$sd/sqrt(dat2$n)
limits <- aes(ymax = mean + (1.96*se), ymin=mean - (1.96*se))
dodge <- position_dodge(width=1)
apatheme=theme_bw()+
  theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank(),
        panel.border=element_blank(),
        axis.line=element_line(),
        text=element_text(family='Times'))
plot2 <- ggplot(dat2, aes(x = RTState, y = mean, fill = FeedbackAccuracy))+
  geom_bar(stat='identity', position=dodge)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  apatheme+
  ylab('Mean POFA')+
  scale_fill_grey()
plot2
ggsave('accXstate.png', width=6, height=6, unit='in', dpi=300)

##State & Valence
#Calculate summary statistics for POFA by IVs.
dat2 <- describeBy(Diss_Final_Datafile_CLEANED$PercepAccScl,list(Diss_Final_Datafile_CLEANED$ParTelic,Diss_Final_Datafile_CLEANED$FdbkValence), mat=TRUE,digits=2)
names(dat2)[names(dat2) == 'group1'] = 'RTState'
names(dat2)[names(dat2) == 'group2'] = 'FeedbackValence'
#levels(dat2$RTState)[levels(dat2$RTState)=='1'] = 'Paratelic'
#levels(dat2$RTState)[levels(dat2$RTState)=='2'] = 'Telic'
#levels(dat2$FeedbackValence)[levels(dat2$FeedbackValence)=='1'] = 'Negative'
#levels(dat2$FeedbackValence)[levels(dat2$FeedbackValence)=='2'] = 'Positive'
dat2$se <- dat2$sd/sqrt(dat2$n)
limits <- aes(ymax = mean + (1.96*se), ymin=mean - (1.96*se))
dodge <- position_dodge(width=1)
apatheme=theme_bw()+
  theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank(),
        panel.border=element_blank(),
        axis.line=element_line(),
        text=element_text(family='Times'))
plot3 <- ggplot(dat2, aes(x = RTState, y = mean, fill = FeedbackValence))+
  geom_bar(stat='identity', position=dodge)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  apatheme+
  ylab('Mean POFA')+
  scale_fill_grey()
plot3
ggsave('stateXvalence.png', width=6, height=6, unit='in', dpi=300)

###Check on weird results with valence and POFA.
dat2 <- describeBy(Diss_Final_Datafile_CLEANED$PercepAccScl,list(AccTy$FdbkValN,AccTy$FdbkAccN), mat=TRUE,digits=2)
names(dat2)[names(dat2) == 'group1'] = 'FeedbackValence'
names(dat2)[names(dat2) == 'group2'] = 'FeedbackAccuracy'
levels(dat2$FeedbackValence)[levels(dat2$FeedbackValence)=='1'] = 'Negative'
levels(dat2$FeedbackValence)[levels(dat2$FeedbackValence)=='2'] = 'Positive'
levels(dat2$FeedbackAccuracy)[levels(dat2$FeedbackAccuracy)=='1'] = 'Inaccurate'
levels(dat2$FeedbackAccuracy)[levels(dat2$FeedbackAccuracy)=='2'] = 'Accurate'
dat2$se <- dat2$sd/sqrt(dat2$n)
limits <- aes(ymax = mean + (1.96*se), ymin=mean - (1.96*se))
dodge <- position_dodge(width=1)
apatheme=theme_bw()+
  theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank(),
        panel.border=element_blank(),
        axis.line=element_line(),
        text=element_text(family='Times'))
plot4 <- ggplot(dat2, aes(x = FeedbackValence, y = mean, fill = FeedbackAccuracy))+
  geom_bar(stat='identity', position=dodge)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  apatheme+
  ylab('Mean POFA')+
  scale_fill_grey()
plot4
ggsave('accuracyXvalence.png', width=6, height=6, unit='in', dpi=300)

##Run model for interactions between accuracy and feedback type.
interaction.plot(FdbkAccN, FdbkTypeN, AccTy$POFA, type="b", col=c(1:3), 
  	leg.bty="o", leg.bg="beige", lwd=2, pch=c(18,24,22),	
   xlab="Feedback Accuracy", 
   ylab="Perceptions of Feedback Accuracy", 
   main="Interaction Plot")

##Run model for interactions between accuracy and state.
interaction.plot(FdbkAccN, ParTelic, AccTy$POFA, type="b", col=c(1:3), 
  	leg.bty="o", leg.bg="beige", lwd=2, pch=c(18,24,22),	
   xlab="Feedback Accuracy", 
   ylab="Perceptions of Feedback Accuracy", 
   main="Interaction Plot")

##Run model for interactions between valence and state.
interaction.plot(FdbkValN, ParTelic, AccTy$POFA, type="b", col=c(1:3), 
  	leg.bty="o", leg.bg="beige", lwd=2, pch=c(18,24,22),
  	fixed = FALSE,
   xlab="Feedback Accuracy", 
   ylab="Perceptions of Feedback Accuracy", 
   main="Interaction Plot")

#To visualize the model, load 'semPlot'.
library(semPlot)
semPaths(fit,  layout = "spring", edge.label.cex = 0.5, curvePivot = TRUE, intercepts = FALSE, residuals = FALSE, thresholds = FALSE, structural = FALSE, gui = TRUE, intStyle = "multi")
```
Show in New WindowClear OutputExpand/Collapse Output
   |++++++++++++++                                    | 27% ~14m 35s      
 Show Traceback
Error: attempt to use zero-length variable name
Modify Chunk OptionsRun All Chunks AboveRun Current ChunkModify Chunk OptionsRun All Chunks AboveRun Current Chunk
Show in New WindowClear OutputExpand/Collapse Output
lavaan WARNING: number of observations (793) too small to compute Gamma
lavaan (0.5-23.1097) converged normally after 271 iterations

  Number of observations                           793

  Estimator                                       DWLS      Robust
  Minimum Function Test Statistic             1944.113    1976.962
  Degrees of freedom                               834         834
  P-value (Chi-square)                           0.000       0.000
  Scaling correction factor                                  1.332
  Shift parameter                                          516.986
    for simple second-order correction (Mplus variant)

Model test baseline model:

  Minimum Function Test Statistic            37317.831   10090.188
  Degrees of freedom                               910         910
  P-value                                        0.000       0.000

User model versus baseline model:

  Comparative Fit Index (CFI)                    0.970       0.875
  Tucker-Lewis Index (TLI)                       0.967       0.864

  Robust Comparative Fit Index (CFI)                            NA
  Robust Tucker-Lewis Index (TLI)                               NA

Root Mean Square Error of Approximation:

  RMSEA                                          0.041       0.042
  90 Percent Confidence Interval          0.039  0.043       0.039  0.044
  P-value RMSEA <= 0.05                          1.000       1.000

  Robust RMSEA                                                  NA
  90 Percent Confidence Interval                                NA     NA

Standardized Root Mean Square Residual:

  SRMR                                           0.052       0.052

Parameter Estimates:

  Information                                 Expected
  Standard Errors                           Robust.sem

Latent Variables:
                   Estimate  Std.Err  z-value  P(>|z|)   Std.lv  Std.all
  POFA =~                                                               
    PercepAcc1        0.991    0.028   35.462    0.000    1.146    0.926
    PercepAcc2        0.822    0.034   24.024    0.000    0.950    0.768
    PercepAcc3        0.966    0.030   32.491    0.000    1.116    0.940
    PercepAcc4Reco    0.924    0.036   25.826    0.000    1.067    0.787
    PercepAcc5        0.986    0.028   34.892    0.000    1.139    0.934
  PA =~                                                                 
    Interested        0.775    0.032   23.909    0.000    0.943    0.782
    Excited           0.825    0.034   24.196    0.000    1.004    0.780
    Strong            0.740    0.036   20.843    0.000    0.901    0.728
    Enthusiastic      0.909    0.033   27.122    0.000    1.106    0.843
    Proud             0.782    0.033   23.416    0.000    0.951    0.747
    Determined        0.775    0.034   22.676    0.000    0.943    0.747
    Attentive         0.588    0.034   17.228    0.000    0.716    0.616
    Active            0.735    0.035   20.721    0.000    0.895    0.702
    Inspired          0.861    0.034   25.153    0.000    1.048    0.798
    Alert             0.591    0.036   16.228    0.000    0.719    0.587
  Na =~                                                                 
    Distressed        0.235    0.048    4.886    0.000    0.391    0.374
    Upset             0.340    0.055    6.197    0.000    0.566    0.528
    Guilty            0.151    0.035    4.305    0.000    0.251    0.274
    Scared           -0.009    0.023   -0.379    0.704   -0.015   -0.021
    Hostile           0.219    0.040    5.448    0.000    0.365    0.443
    Ashamed           0.176    0.042    4.133    0.000    0.292    0.283
    Nervous           0.010    0.035    0.275    0.783    0.016    0.016
    Afraid           -0.002    0.023   -0.072    0.942   -0.003   -0.004
    Jittery          -0.071    0.033   -2.180    0.029   -0.119   -0.122
    Irritable         0.404    0.061    6.645    0.000    0.674    0.616
  DTR =~                                                                
    DesToResp1        0.564    0.035   16.084    0.000    0.748    0.767
    DesToResp2        0.727    0.037   19.674    0.000    0.965    0.810
    DesToResp3        0.570    0.037   15.400    0.000    0.755    0.674
    DesToResp4Reco    0.528    0.040   13.055    0.000    0.700    0.595
  DJ =~                                                                 
    DisJust1          0.578    0.039   14.883    0.000    0.957    0.755
    DisJust2          0.698    0.042   16.725    0.000    1.156    0.930
    DisJust3          0.664    0.041   16.026    0.000    1.099    0.906
    DisJust4          0.692    0.042   16.453    0.000    1.146    0.938
  Activation =~                                                         
    Interested        0.104    0.043    2.409    0.016    0.104    0.087
    Excited           0.136    0.043    3.187    0.001    0.136    0.106
    Strong            0.004    0.042    0.106    0.916    0.004    0.004
    Enthusiastic     -0.007    0.045   -0.163    0.870   -0.007   -0.006
    Proud            -0.146    0.041   -3.548    0.000   -0.146   -0.115
    Determined        0.145    0.044    3.330    0.001    0.145    0.115
    Attentive         0.098    0.046    2.135    0.033    0.098    0.084
    Active            0.119    0.044    2.708    0.007    0.119    0.094
    Inspired          0.102    0.046    2.235    0.025    0.102    0.078
    Alert             0.196    0.047    4.145    0.000    0.196    0.160
    Distressed        0.751    0.044   17.163    0.000    0.751    0.717
    Upset             0.648    0.046   13.969    0.000    0.648    0.605
    Guilty            0.499    0.046   10.937    0.000    0.499    0.546
    Scared            0.487    0.043   11.442    0.000    0.487    0.704
    Hostile           0.323    0.044    7.381    0.000    0.323    0.391
    Ashamed           0.618    0.050   12.331    0.000    0.618    0.599
    Nervous           0.781    0.042   18.471    0.000    0.781    0.766
    Afraid            0.458    0.043   10.563    0.000    0.458    0.674
    Jittery           0.677    0.043   15.846    0.000    0.677    0.691
    Irritable         0.538    0.049   10.904    0.000    0.538    0.492

Regressions:
                   Estimate  Std.Err  z-value  P(>|z|)   Std.lv  Std.all
  Perf2 ~                                                               
    Goal2Lvl (f11)    0.103    0.042    2.427    0.015    0.103    0.109
    Perf1             0.675    0.042   16.079    0.000    0.675    0.574
  Goal2Lvl ~                                                            
    DTR      (e11)    0.272    0.050    5.434    0.000    0.361    0.235
    Goal1Lvl          0.892    0.050   17.741    0.000    0.892    0.615
  DTR ~                                                                 
    PA       (c11)    0.495    0.061    8.128    0.000    0.455    0.455
    Na       (c12)    0.112    0.055    2.034    0.042    0.141    0.141
    DJ       (d31)    0.341    0.050    6.881    0.000    0.426    0.426
  DJ ~                                                                  
    POFA     (c21)    1.141    0.100   11.385    0.000    0.797    0.797
  POFA ~                                                                
    FdbkValN (a31)   -0.446    0.099   -4.511    0.000   -0.386   -0.193
    FdbkAccN (a32)   -1.060    0.095  -11.217    0.000   -0.917   -0.459
    FdbkTypN          0.375    0.081    4.635    0.000    0.324    0.162
    ParTelic          0.097    0.087    1.113    0.266    0.084    0.040
    INTAccTy (b42)    1.287    0.167    7.684    0.000    1.114    0.278
    INTPrFkA (b41)    0.692    0.219    3.166    0.002    0.599    0.142
    INTPrFkV (b31)    0.862    0.225    3.831    0.000    0.746    0.176
  PA ~                                                                  
    FdbkValN (a11)   -1.080    0.098  -10.998    0.000   -0.887   -0.444
    DJ       (d21)    0.283    0.031    9.015    0.000    0.385    0.385
    ParTelic          0.460    0.092    4.992    0.000    0.378    0.181
    INTPrFkV (b11)   -0.088    0.181   -0.486    0.627   -0.072   -0.017
  Na ~                                                                  
    FdbkValN (a21)    2.152    0.388    5.544    0.000    1.292    0.646
    DJ       (d11)   -0.533    0.084   -6.377    0.000   -0.529   -0.529
    ParTelic         -0.020    0.187   -0.110    0.913   -0.012   -0.006
    INTPrFkV (b21)   -0.137    0.397   -0.344    0.731   -0.082   -0.019

Covariances:
                   Estimate  Std.Err  z-value  P(>|z|)   Std.lv  Std.all
 .PA ~~                                                                 
   .Na                0.000                               0.000    0.000
    Activation        0.000                               0.000    0.000
 .Na ~~                                                                 
    Activation        0.000                               0.000    0.000
  Perf1 ~~                                                              
    Goal1Lvl          0.295    0.051    5.729    0.000    0.295    0.225
    FdbkValN          0.028    0.029    0.968    0.333    0.028    0.046
    FdbkAccN         -0.046    0.028   -1.658    0.097   -0.046   -0.074
    FdbkTypeN        -0.021    0.024   -0.888    0.375   -0.021   -0.035
    ParTelic          0.026    0.025    1.020    0.308    0.026    0.044
    INTAccType       -0.005    0.012   -0.410    0.682   -0.005   -0.016
    INTParaFkAcc      0.024    0.011    2.214    0.027    0.024    0.083
    INTParaFkVal      0.012    0.011    1.083    0.279    0.012    0.041
  Goal1Lvl ~~                                                           
    FdbkValN         -0.056    0.025   -2.281    0.023   -0.056   -0.106
    FdbkAccN          0.031    0.024    1.285    0.199    0.031    0.058
    FdbkTypeN         0.063    0.020    3.055    0.002    0.063    0.118
    ParTelic          0.033    0.021    1.569    0.117    0.033    0.064
    INTAccType       -0.006    0.011   -0.588    0.556   -0.006   -0.024
    INTParaFkAcc     -0.017    0.010   -1.761    0.078   -0.017   -0.067
    INTParaFkVal      0.007    0.010    0.781    0.435    0.007    0.030
  FdbkValN ~~                                                           
    FdbkAccN         -0.163    0.007  -23.157    0.000   -0.163   -0.652
    FdbkTypeN        -0.015    0.011   -1.346    0.178   -0.015   -0.061
    ParTelic          0.041    0.009    4.670    0.000    0.041    0.173
    INTAccType        0.004    0.006    0.710    0.478    0.004    0.032
    INTParaFkAcc     -0.002    0.005   -0.417    0.676   -0.002   -0.016
    INTParaFkVal     -0.001    0.004   -0.219    0.827   -0.001   -0.008
  FdbkAccN ~~                                                           
    FdbkTypeN         0.007    0.009    0.790    0.429    0.007    0.028
    ParTelic         -0.016    0.009   -1.748    0.081   -0.016   -0.065
    INTAccType        0.000    0.004    0.052    0.959    0.000    0.002
    INTParaFkAcc      0.002    0.004    0.525    0.600    0.002    0.019
    INTParaFkVal     -0.001    0.004   -0.136    0.892   -0.001   -0.005
  FdbkTypeN ~~                                                          
    ParTelic         -0.001    0.009   -0.154    0.877   -0.001   -0.006
    INTAccType        0.000    0.004    0.075    0.940    0.000    0.003
    INTParaFkAcc      0.005    0.004    1.141    0.254    0.005    0.041
    INTParaFkVal     -0.003    0.004   -0.701    0.483   -0.003   -0.025
  ParTelic ~~                                                           
    INTAccType        0.005    0.005    0.964    0.335    0.005    0.038
    INTParaFkAcc      0.006    0.005    1.296    0.195    0.006    0.057
    INTParaFkVal     -0.009    0.005   -1.830    0.067   -0.009   -0.079
  INTAccType ~~                                                         
    INTParaFkAcc      0.000    0.002    0.095    0.924    0.000    0.003
    INTParaFkVal     -0.000    0.002   -0.174    0.862   -0.000   -0.006
  INTParaFkAcc ~~                                                       
    INTParaFkVal     -0.038    0.002  -19.004    0.000   -0.038   -0.673

Intercepts:
                   Estimate  Std.Err  z-value  P(>|z|)   Std.lv  Std.all
   .PercepAcc1        4.892    0.269   18.190    0.000    4.892    3.954
   .PercepAcc2        4.497    0.228   19.684    0.000    4.497    3.639
   .PercepAcc3        4.863    0.265   18.342    0.000    4.863    4.096
   .PercepAcc4Reco    4.860    0.255   19.075    0.000    4.860    3.583
   .PercepAcc5        4.800    0.270   17.797    0.000    4.800    3.938
   .Interested        4.137    0.164   25.223    0.000    4.137    3.432
   .Excited           3.443    0.185   18.633    0.000    3.443    2.674
   .Strong            3.286    0.167   19.730    0.000    3.286    2.657
   .Enthusiastic      3.781    0.196   19.304    0.000    3.781    2.883
   .Proud             3.212    0.185   17.390    0.000    3.212    2.522
   .Determined        4.404    0.162   27.191    0.000    4.404    3.488
   .Attentive         4.343    0.127   34.071    0.000    4.343    3.735
   .Active            3.771    0.158   23.890    0.000    3.771    2.960
   .Inspired          3.512    0.186   18.842    0.000    3.512    2.674
   .Alert             4.154    0.133   31.131    0.000    4.154    3.391
   .Distressed        0.798    0.144    5.556    0.000    0.798    0.763
   .Upset             0.368    0.156    2.355    0.019    0.368    0.343
   .Guilty            0.857    0.108    7.951    0.000    0.857    0.936
   .Scared            1.301    0.099   13.197    0.000    1.301    1.882
   .Hostile           0.470    0.138    3.414    0.001    0.470    0.569
   .Ashamed           0.903    0.131    6.907    0.000    0.903    0.875
   .Nervous           1.701    0.148   11.511    0.000    1.701    1.668
   .Afraid            1.263    0.096   13.110    0.000    1.263    1.860
   .Jittery           1.930    0.154   12.512    0.000    1.930    1.971
   .Irritable         0.100    0.181    0.555    0.579    0.100    0.092
   .DesToResp1        4.315    0.131   32.819    0.000    4.315    4.425
   .DesToResp2        3.821    0.170   22.438    0.000    3.821    3.207
   .DesToResp3        3.814    0.136   27.976    0.000    3.814    3.401
   .DesToResp4Reco    4.046    0.129   31.243    0.000    4.046    3.439
   .DisJust1          4.320    0.189   22.806    0.000    4.320    3.411
   .DisJust2          4.731    0.220   21.520    0.000    4.731    3.806
   .DisJust3          4.650    0.210   22.186    0.000    4.650    3.835
   .DisJust4          4.734    0.218   21.692    0.000    4.734    3.877
   .Perf2             0.316    0.171    1.844    0.065    0.316    0.217
   .Goal2Lvl         -0.198    0.267   -0.741    0.458   -0.198   -0.129
    Perf1             2.053    0.044   46.786    0.000    2.053    1.663
    Goal1Lvl          5.179    0.039  133.604    0.000    5.179    4.883
    FdbkValN          1.506    0.018   84.699    0.000    1.506    3.010
    FdbkAccN          1.504    0.018   84.626    0.000    1.504    3.007
    FdbkTypeN         1.504    0.018   84.626    0.000    1.504    3.007
    ParTelic          1.649    0.017   97.223    0.000    1.649    3.455
    INTAccType        0.008    0.009    0.885    0.376    0.008    0.031
    INTParaFkAcc     -0.016    0.008   -1.904    0.057   -0.016   -0.068
    INTParaFkVal      0.034    0.008    3.987    0.000    0.034    0.142
   .POFA              0.000                               0.000    0.000
   .PA                0.000                               0.000    0.000
   .Na                0.000                               0.000    0.000
   .DTR               0.000                               0.000    0.000
   .DJ                0.000                               0.000    0.000
    Activation        0.000                               0.000    0.000

Variances:
                   Estimate  Std.Err  z-value  P(>|z|)   Std.lv  Std.all
   .PercepAcc1        0.218    0.032    6.777    0.000    0.218    0.143
   .PercepAcc2        0.625    0.063    9.847    0.000    0.625    0.409
   .PercepAcc3        0.164    0.032    5.172    0.000    0.164    0.117
   .PercepAcc4Reco    0.701    0.075    9.372    0.000    0.701    0.381
   .PercepAcc5        0.188    0.035    5.316    0.000    0.188    0.127
   .Interested        0.552    0.039   14.209    0.000    0.552    0.380
   .Excited           0.631    0.046   13.715    0.000    0.631    0.381
   .Strong            0.719    0.050   14.490    0.000    0.719    0.470
   .Enthusiastic      0.498    0.047   10.656    0.000    0.498    0.289
   .Proud             0.695    0.049   14.083    0.000    0.695    0.429
   .Determined        0.684    0.045   15.258    0.000    0.684    0.429
   .Attentive         0.830    0.047   17.705    0.000    0.830    0.614
   .Active            0.809    0.053   15.350    0.000    0.809    0.498
   .Inspired          0.617    0.044   13.908    0.000    0.617    0.358
   .Alert             0.945    0.053   17.912    0.000    0.945    0.630
   .Distressed        0.379    0.043    8.895    0.000    0.379    0.346
   .Upset             0.409    0.042    9.655    0.000    0.409    0.356
   .Guilty            0.526    0.044   11.914    0.000    0.526    0.627
   .Scared            0.241    0.029    8.293    0.000    0.241    0.504
   .Hostile           0.444    0.047    9.371    0.000    0.444    0.651
   .Ashamed           0.598    0.049   12.133    0.000    0.598    0.561
   .Nervous           0.429    0.044    9.667    0.000    0.429    0.413
   .Afraid            0.251    0.030    8.355    0.000    0.251    0.545
   .Jittery           0.486    0.047   10.375    0.000    0.486    0.507
   .Irritable         0.453    0.047    9.641    0.000    0.453    0.378
   .DesToResp1        0.392    0.041    9.661    0.000    0.392    0.412
   .DesToResp2        0.489    0.059    8.275    0.000    0.489    0.344
   .DesToResp3        0.687    0.060   11.399    0.000    0.687    0.546
   .DesToResp4Reco    0.894    0.078   11.432    0.000    0.894    0.646
   .DisJust1          0.689    0.059   11.601    0.000    0.689    0.430
   .DisJust2          0.209    0.037    5.596    0.000    0.209    0.135
   .DisJust3          0.262    0.040    6.638    0.000    0.262    0.179
   .DisJust4          0.179    0.037    4.890    0.000    0.179    0.120
   .Perf2             1.354    0.077   17.497    0.000    1.354    0.641
   .Goal2Lvl          1.326    0.093   14.313    0.000    1.326    0.561
   .POFA              1.000                               0.749    0.749
   .PA                1.000                               0.675    0.675
   .Na                1.000                               0.360    0.360
   .DTR               1.000                               0.568    0.568
   .DJ                1.000                               0.365    0.365
    Activation        1.000                               1.000    1.000
    Perf1             1.524    0.068   22.443    0.000    1.524    1.000
    Goal1Lvl          1.125    0.040   28.247    0.000    1.125    1.000
    FdbkValN          0.250    0.000 1240.777    0.000    0.250    1.000
    FdbkAccN          0.250    0.000 1594.908    0.000    0.250    1.000
    FdbkTypeN         0.250    0.000 1594.990    0.000    0.250    1.000
    ParTelic          0.228    0.005   44.760    0.000    0.228    1.000
    INTAccType        0.063    0.000  416.906    0.000    0.063    1.000
    INTParaFkAcc      0.057    0.001   43.874    0.000    0.057    1.000
    INTParaFkVal      0.056    0.001   41.704    0.000    0.056    1.000

Defined Parameters:
                   Estimate  Std.Err  z-value  P(>|z|)   Std.lv  Std.all
    ValPaDtrG        -0.015    0.007   -2.040    0.041   -0.015   -0.005
    ValNaDtrG         0.007    0.004    1.585    0.113    0.007    0.002
    ValPfaDjNaDtrG    0.001    0.001    1.440    0.150    0.001    0.000
    ValPfaDjPaDtrG   -0.002    0.001   -1.794    0.073   -0.002   -0.001
    ValPfaDjDtrG     -0.005    0.003   -1.813    0.070   -0.005   -0.002
    AccPfaDjNaDtrG    0.002    0.001    1.534    0.125    0.002    0.001
    AccPfaDjPaDtrG   -0.005    0.002   -2.014    0.044   -0.005   -0.002
    AccPfaDjDtrG     -0.012    0.006   -2.039    0.041   -0.012   -0.004
    ValStPa          -0.001    0.003   -0.478    0.632   -0.001   -0.000
    ValStNa          -0.000    0.001   -0.340    0.734   -0.000   -0.000
    ValStPofa        -0.000    0.000   -1.188    0.235   -0.000   -0.000
    AccTypPofa       -0.000    0.000   -1.286    0.198   -0.000   -0.000
    AccStPofa        -0.000    0.000   -1.153    0.249   -0.000   -0.000


```{r BiFactor, include = TRUE}
DissSEM2 <- '
  # latent variable definitions - Bifactor added
    POFA   =~ PercepAcc1 + PercepAcc2 + PercepAcc3 + PercepAcc4Reco + PercepAcc5
    PA =~ Interested + Excited + Strong + Enthusiastic + Proud + Determined + Attentive + Active + Inspired + Alert
    Na =~ Distressed + Upset + Guilty + Scared + Hostile + Ashamed + Nervous + Afraid + Jittery + Irritable
    DTR  =~ DesToResp1 + DesToResp2 + DesToResp3 + DesToResp4Reco
    DJ =~ DisJust1 + DisJust2  + DisJust3 + DisJust4

#Bifactor
Activation =~ Interested + Excited + Strong + Enthusiastic + Proud + Determined + Attentive + Active + Inspired + Alert + Distressed + Upset + Guilty + Scared + Hostile + Ashamed + Nervous + Afraid + Jittery + Irritable

            #Constrain PA and Na covariance to 0
            PA~~0*Na
            PA~~0*Activation
            Na~~0*Activation

#Outcome Model
  #PerfResidGain ~ f11*GoalResidGain
  Perf2 ~ f11*Goal2Lvl + Perf1
#Mediators Model
  #GoalResidGain ~ e11*DTR
  Goal2Lvl ~ e11*DTR + Goal1Lvl
  DTR ~ c11*PA + c12*Na + d31*DJ
  DJ ~ c21*POFA
  POFA ~ a31*FdbkValN + a32*FdbkAccN + FdbkTypeN + ParTelic + b42*INTAccType + b41*INTParaFkAcc + b31*INTParaFkVal
  PA ~ a11*FdbkValN + d21*DJ + ParTelic+ b11*INTParaFkVal
  Na ~ a21*FdbkValN + d11*DJ + ParTelic+ b21*INTParaFkVal
#Indirect Main Effects
  ValPaDtrG := f11*e11*c11*a11
  ValNaDtrG := f11*e11*c12*a21
  ValPfaDjNaDtrG := f11*e11*c12*d11*c21*a31
  ValPfaDjPaDtrG := f11*e11*c11*d21*c21*a31
  ValPfaDjDtrG := f11*e11*d31*c21*a31
  AccPfaDjNaDtrG := f11*e11*c12*d11*c21*a32
  AccPfaDjPaDtrG := f11*e11*c11*d21*c21*a32
  AccPfaDjDtrG := f11*e11*d31*c21*a32
#Moderating Effects
  ValStPa := f11*e11*c11*b11
  ValStNa := f11*e11*c12*b21
  ValStPofa := f11*e11*d11*d21*d31*c11*c12*c21*b31
  AccTypPofa := f11*e11*d11*d21*d31*c11*c12*c21*b42
  AccStPofa := f11*e11*d11*d21*d31*c11*c12*c21*b41
'

fit <- lavaan::sem(DissSEM2, data = data, std.lv = TRUE, estimator = "WLSMV")
summary(fit, fit.measures=TRUE,standardized = TRUE)
```

```{r Post-Defence Controlling for Task Difficulty, include = TRUE}
#Create interaction term of RGB List with Goal1
data$INTRGBList1Goal1 <- (data$Task1RGB-(mean(data$Task1RGB))) * (data$Goal1Lvl-(mean(data$Goal1Lvl)))
data$INTRGBList2Goal2 <- (data$Task2RGB-(mean(data$Task2RGB))) * (data$Goal2Lvl-(mean(data$Goal2Lvl)))

ListOneData <- subset(data, Task2RGB==1)

#SEM
DissSEM2 <- '
  # latent variable definitions 
    POFA   =~ PercepAcc1 + PercepAcc2 + PercepAcc3 + PercepAcc4Reco + PercepAcc5
    PA =~ Interested + Excited + Strong + Enthusiastic + Proud + Determined + Attentive + Active + Inspired + Alert
    Na =~ Distressed + Upset + Guilty + Scared + Hostile + Ashamed + Nervous + Afraid
    DTR  =~ DesToResp1 + DesToResp2 + DesToResp3 + DesToResp4Reco
    DJ =~ DisJust1 + DisJust2  + DisJust3 + DisJust4
#Feedback Loop
  ##FdbkAccN =~ Perf1 + Goal1Lvl + FdbkValN
#Outcome Model
  #PerfResidGain ~ f11*GoalResidGain
  #Perf1 ~ Goal1Lvl + Task1RGB
  #Perf1 ~ Goal1Lvl + g11*Task1RGB + g12*INTRGBList1Goal1
  Perf1 ~ Goal1Lvl
  #Perf2 ~ f11*Goal2Lvl + Perf1
  #Perf2 ~ f11*Goal2Lvl + Perf1 + g21*Task2RGB + g22*INTRGBList2Goal2
  Perf2 ~ f11*Goal2Lvl + Perf1

#Mediators Model
  #GoalResidGain ~ e11*DTR
  Goal2Lvl ~ e11*DTR + Goal1Lvl
  DTR ~ c11*PA + c12*Na + d31*DJ
  DJ ~ c21*POFA
  POFA ~ a31*FdbkValN + a32*FdbkAccN + FdbkTypeN + ParTelic + b42*INTAccType + b41*INTParaFkAcc + b31*INTParaFkVal
  PA ~ a11*FdbkValN + d21*DJ + ParTelic+ b11*INTParaFkVal
  Na ~ a21*FdbkValN + d11*DJ + ParTelic+ b21*INTParaFkVal
#Indirect Main Effects
  ValPaDtrG := f11*e11*c11*a11
  ValNaDtrG := f11*e11*c12*a21
  ValPfaDjNaDtrG := f11*e11*c12*d11*c21*a31
  ValPfaDjPaDtrG := f11*e11*c11*d21*c21*a31
  ValPfaDjDtrG := f11*e11*d31*c21*a31
  AccPfaDjNaDtrG := f11*e11*c12*d11*c21*a32
  AccPfaDjPaDtrG := f11*e11*c11*d21*c21*a32
  AccPfaDjDtrG := f11*e11*d31*c21*a32
#Moderating Effects
  ValStPa := f11*e11*c11*b11
  ValStNa := f11*e11*c12*b21
  ValStPofa := f11*e11*d11*d21*d31*c11*c12*c21*b31
  AccTypPofa := f11*e11*d11*d21*d31*c11*c12*c21*b42
  AccStPofa := f11*e11*d11*d21*d31*c11*c12*c21*b41
  #RGB2List := g22*e11*d31*d21*d11*c11*c12*c21*a32
#Total Significant Effects
  TotalAccEff := f11*e11*c11*d21*c21*a32 + f11*e11*d31*c21*a32
'
#Fit 'SEM' model to data
fit <- sem(DissSEM2, ListOneData, std.lv = TRUE, estimator = "WLSMV")
summary(fit, fit.measures=TRUE,standardized = TRUE, rsquare=TRUE, ci=TRUE)
factor.scores <- predict(fit)
factor.scores <- as.data.frame(factor.scores)
factor.scores <- as.data.frame(factor.scores$POFA)
names(factor.scores) <- c("POFA")

#To visualize/plot the intraction effects, run ANOVAs and plot the results.
##Create scale scores for POFA
AccTy <- cbind(factor.scores,data[c(1,2,3,4)])
fit <- aov(POFA ~ FdbkTypeN*FdbkAccN + ParTelic*FdbkAccN + ParTelic*FdbkValN, data=AccTy) # same thing
summary(fit)
require(graphics)
FdbkTypeN <- as.factor(AccTy$FdbkTypeN)
FdbkAccN <- as.factor(AccTy$FdbkAccN)
ParTelic <- as.factor(AccTy$ParTelic)
FdbkValN <- as.factor(AccTy$FdbkValN)

#Plots using ggplot2
##Accuracy & Type
##Calculate summary statistics for POFA by IVs.
library(psych)
library(ggplot2)
dat2 <- describeBy(Diss_Final_Datafile_CLEANED$PercepAccScl,list(Diss_Final_Datafile_CLEANED$FdbkType,Diss_Final_Datafile_CLEANED$FdbkAccuracy), mat=TRUE,digits=2)
names(dat2)[names(dat2) == 'group1'] = 'FeedbackType'
names(dat2)[names(dat2) == 'group2'] = 'FeedbackAccuracy'
#levels(dat2$FeedbackType)[levels(dat2$FeedbackType)=='1'] = 'Relative'
#levels(dat2$FeedbackType)[levels(dat2$FeedbackType)=='2'] = 'Nominal'
#levels(dat2$FeedbackAccuracy)[levels(dat2$FeedbackAccuracy)=='1'] = 'Inaccurate'
#levels(dat2$FeedbackAccuracy)[levels(dat2$FeedbackAccuracy)=='2'] = 'Accurate'
dat2$se <- dat2$sd/sqrt(dat2$n)
limits <- aes(ymax = mean + (1.96*se), ymin=mean - (1.96*se))
dodge <- position_dodge(width=1)
apatheme=theme_bw()+
  theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank(),
        panel.border=element_blank(),
        axis.line=element_line(),
        text=element_text(family='Times'))
plot1 <- ggplot(dat2, aes(x = FeedbackType, y = mean, fill = FeedbackAccuracy))+
  geom_bar(stat='identity', position=dodge)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  apatheme+
  ylab('Mean POFA')+
  scale_fill_grey()
plot1
ggsave('accXtype.png', width=6, height=6, unit='in', dpi=300)

##Accuracy & State
#Calculate summary statistics for POFA by IVs.
dat2 <- describeBy(Diss_Final_Datafile_CLEANED$PercepAccScl,list(Diss_Final_Datafile_CLEANED$ParTelic,Diss_Final_Datafile_CLEANED$FdbkAccuracy), mat=TRUE,digits=2)
names(dat2)[names(dat2) == 'group1'] = 'RTState'
names(dat2)[names(dat2) == 'group2'] = 'FeedbackAccuracy'
#levels(dat2$FeedbackAccuracy)[levels(dat2$FeedbackAccuracy)=='1'] = 'Inaccurate'
#levels(dat2$FeedbackAccuracy)[levels(dat2$FeedbackAccuracy)=='2'] = 'Accurate'
#levels(dat2$RTState)[levels(dat2$RTState)=='1'] = 'Paratelic'
#levels(dat2$RTState)[levels(dat2$RTState)=='2'] = 'Telic'
dat2$se <- dat2$sd/sqrt(dat2$n)
limits <- aes(ymax = mean + (1.96*se), ymin=mean - (1.96*se))
dodge <- position_dodge(width=1)
apatheme=theme_bw()+
  theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank(),
        panel.border=element_blank(),
        axis.line=element_line(),
        text=element_text(family='Times'))
plot2 <- ggplot(dat2, aes(x = RTState, y = mean, fill = FeedbackAccuracy))+
  geom_bar(stat='identity', position=dodge)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  apatheme+
  ylab('Mean POFA')+
  scale_fill_grey()
plot2
ggsave('accXstate.png', width=6, height=6, unit='in', dpi=300)

##State & Valence
#Calculate summary statistics for POFA by IVs.
dat2 <- describeBy(Diss_Final_Datafile_CLEANED$PercepAccScl,list(Diss_Final_Datafile_CLEANED$ParTelic,Diss_Final_Datafile_CLEANED$FdbkValence), mat=TRUE,digits=2)
names(dat2)[names(dat2) == 'group1'] = 'RTState'
names(dat2)[names(dat2) == 'group2'] = 'FeedbackValence'
#levels(dat2$RTState)[levels(dat2$RTState)=='1'] = 'Paratelic'
#levels(dat2$RTState)[levels(dat2$RTState)=='2'] = 'Telic'
#levels(dat2$FeedbackValence)[levels(dat2$FeedbackValence)=='1'] = 'Negative'
#levels(dat2$FeedbackValence)[levels(dat2$FeedbackValence)=='2'] = 'Positive'
dat2$se <- dat2$sd/sqrt(dat2$n)
limits <- aes(ymax = mean + (1.96*se), ymin=mean - (1.96*se))
dodge <- position_dodge(width=1)
apatheme=theme_bw()+
  theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank(),
        panel.border=element_blank(),
        axis.line=element_line(),
        text=element_text(family='Times'))
plot3 <- ggplot(dat2, aes(x = RTState, y = mean, fill = FeedbackValence))+
  geom_bar(stat='identity', position=dodge)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  apatheme+
  ylab('Mean POFA')+
  scale_fill_grey()
plot3
ggsave('stateXvalence.png', width=6, height=6, unit='in', dpi=300)

###Check on weird results with valence and POFA.
dat2 <- describeBy(Diss_Final_Datafile_CLEANED$PercepAccScl,list(AccTy$FdbkValN,AccTy$FdbkAccN), mat=TRUE,digits=2)
names(dat2)[names(dat2) == 'group1'] = 'FeedbackValence'
names(dat2)[names(dat2) == 'group2'] = 'FeedbackAccuracy'
levels(dat2$FeedbackValence)[levels(dat2$FeedbackValence)=='1'] = 'Negative'
levels(dat2$FeedbackValence)[levels(dat2$FeedbackValence)=='2'] = 'Positive'
levels(dat2$FeedbackAccuracy)[levels(dat2$FeedbackAccuracy)=='1'] = 'Inaccurate'
levels(dat2$FeedbackAccuracy)[levels(dat2$FeedbackAccuracy)=='2'] = 'Accurate'
dat2$se <- dat2$sd/sqrt(dat2$n)
limits <- aes(ymax = mean + (1.96*se), ymin=mean - (1.96*se))
dodge <- position_dodge(width=1)
apatheme=theme_bw()+
  theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank(),
        panel.border=element_blank(),
        axis.line=element_line(),
        text=element_text(family='Times'))
plot4 <- ggplot(dat2, aes(x = FeedbackValence, y = mean, fill = FeedbackAccuracy))+
  geom_bar(stat='identity', position=dodge)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  apatheme+
  ylab('Mean POFA')+
  scale_fill_grey()
plot4
ggsave('accuracyXvalence.png', width=6, height=6, unit='in', dpi=300)

##Run model for interactions between accuracy and feedback type.
interaction.plot(FdbkAccN, FdbkTypeN, AccTy$POFA, type="b", col=c(1:3), 
  	leg.bty="o", leg.bg="beige", lwd=2, pch=c(18,24,22),	
   xlab="Feedback Accuracy", 
   ylab="Perceptions of Feedback Accuracy", 
   main="Interaction Plot")

##Run model for interactions between accuracy and state.
interaction.plot(FdbkAccN, ParTelic, AccTy$POFA, type="b", col=c(1:3), 
  	leg.bty="o", leg.bg="beige", lwd=2, pch=c(18,24,22),	
   xlab="Feedback Accuracy", 
   ylab="Perceptions of Feedback Accuracy", 
   main="Interaction Plot")

##Run model for interactions between valence and state.
interaction.plot(FdbkValN, ParTelic, AccTy$POFA, type="b", col=c(1:3), 
  	leg.bty="o", leg.bg="beige", lwd=2, pch=c(18,24,22),
  	fixed = FALSE,
   xlab="Feedback Accuracy", 
   ylab="Perceptions of Feedback Accuracy", 
   main="Interaction Plot")

#To visualize the model, load 'semPlot'.
library(semPlot)
semPaths(fit,  layout = "spring", edge.label.cex = 0.5, curvePivot = TRUE, intercepts = FALSE, residuals = FALSE, thresholds = FALSE, structural = FALSE, gui = TRUE, intStyle = "multi")
```
# Without RT
```{r Without RT}
#SEM
DissSEM3 <- '
  # latent variable definitions - REMOVED JITTERY AND IRRITABLE
    POFA   =~ PercepAcc1 + PercepAcc2 + PercepAcc3 + PercepAcc4Reco + PercepAcc5
    PA =~ Interested + Excited + Strong + Enthusiastic + Proud + Determined + Attentive + Active + Inspired + Alert
    Na =~ Distressed + Upset + Guilty + Scared + Hostile + Ashamed + Nervous + Afraid
    DTR  =~ DesToResp1 + DesToResp2 + DesToResp3 + DesToResp4Reco
    DJ =~ DisJust1 + DisJust2  + DisJust3 + DisJust4

#Outcome Model
  #PerfResidGain ~ f11*GoalResidGain
  Perf1 ~ Goal1Lvl
  Perf2 ~ f11*Goal2Lvl + Perf1
#Mediators Model
  #GoalResidGain ~ e11*DTR
  Goal2Lvl ~ e11*DTR + Goal1Lvl
  DTR ~ c11*PA + c12*Na + d31*DJ
  DJ ~ c21*POFA
  POFA ~ a31*FdbkValN + a32*FdbkAccN + FdbkTypeN  + b42*INTAccType
  PA ~ a11*FdbkValN + d21*DJ
  Na ~ a21*FdbkValN + d11*DJ
#Indirect Main Effects
  ValPaDtrG := f11*e11*c11*a11
  ValNaDtrG := f11*e11*c12*a21
  ValPfaDjNaDtrG := f11*e11*c12*d11*c21*a31
  ValPfaDjPaDtrG := f11*e11*c11*d21*c21*a31
  ValPfaDjDtrG := f11*e11*d31*c21*a31
  AccPfaDjNaDtrG := f11*e11*c12*d11*c21*a32
  AccPfaDjPaDtrG := f11*e11*c11*d21*c21*a32
  AccPfaDjDtrG := f11*e11*d31*c21*a32
#Moderating Effects
  AccTypPofa := f11*e11*d11*d21*d31*c11*c12*c21*b42
#Total Significant Effects
  TotalAccEff := f11*e11*c11*d21*c21*a32 + f11*e11*d31*c21*a32
'
#Fit 'SEM' model to data
fit <- lavaan::sem(DissSEM3, data , std.lv = TRUE, estimator = "WLSMV")
summary(fit, fit.measures=TRUE,standardized = TRUE, rsquare=TRUE, ci=TRUE) 
```
# References
```{r create_r-references}
r_refs(file = "r-references.bib")
```

\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}
